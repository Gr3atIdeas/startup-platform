{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}Регистрация{% endblock %}

{% block head_extra %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'accounts/css/register.css' %}?v={% now 'U' %}">
{% endblock %}

{% block content %}
    <canvas id="starfield-canvas"></canvas>

    <div class="auth-container">
        <div class="auth-box">
            <h1>Регистрация</h1>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit">Зарегистрироваться</button>
            </form>
            <div class="login-link">
                <p>Уже есть аккаунт? <a href="{% url 'login' %}">Войти</a></p>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const D=document;
    const c=window;
    let d=c.innerWidth;
    let e=c.innerHeight;
    const g=D.getElementById('starfield-canvas');
    if (!g) return;
    let i=d/2;
    let j=e/2;
    g.width=d;
    g.height=e;
    const k=g.getContext("2d");
    if (!k) return;
    
    let targetOffsetX = d / 2;
    let targetOffsetY = e / 2;
    let currentOffsetX = d / 2;
    let currentOffsetY = e / 2;
    const smoothing = 0.05;

    c.onmousemove = (event) => {
        targetOffsetX = event.clientX;
        targetOffsetY = event.clientY;
    };
    
    c.onresize=()=>{
        d=c.innerWidth;
        e=c.innerHeight;
        g.width=d;
        g.height=e;
    };

    let stars = [];
    for(let n=0; n<500; n++){
        stars[n] = {
            x: Math.random() * d - d / 2,
            y: Math.random() * e - e / 2,
            z: Math.random() * d
        };
    }

    function draw() {
        k.fillStyle = "black";
        k.fillRect(0, 0, d, e);

        currentOffsetX += (targetOffsetX - currentOffsetX) * smoothing;
        currentOffsetY += (targetOffsetY - currentOffsetY) * smoothing;
        
        k.save();
        k.translate(currentOffsetX, currentOffsetY);

        for(let n=0; n<500; n++){
            let star = stars[n];
            star.z -= 1;
            if(star.z <= 0) {
                star.x = Math.random() * d - i;
                star.y = Math.random() * e - j;
                star.z = d;
            }

            let s = d / (d + star.z);
            let r = s * 2;
            k.beginPath();
            k.fillStyle = `rgba(255, 255, 255, ${s > 0.1 ? s : 0.1})`;
            k.arc(star.x, star.y, r, 0, 2 * Math.PI);
            k.fill();
        }
        k.restore();
        c.requestAnimationFrame(draw);
    }
    draw();
});
</script>
{% endblock %}
