{% extends 'accounts/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Панель модератора - Заявки{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'accounts/css/moderator_dashboard.css' %}">
<script>
    // Placeholder for future JS if needed for filters, search, etc.
    document.addEventListener('DOMContentLoaded', function () {
        // Example: make "Все" button active by default or based on URL params
        const filterButtons = document.querySelectorAll('.filter-button');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active')); // Or toggle 'inactive'
                this.classList.add('active');
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<body class="moderator-dashboard-body">
    <div class="moderator-page-container">
        <header class="page-header">
            <div class="header-title-block">
                <h1 class="header-title-main">Заявки на</h1>
                <h2 class="header-title-highlight">СТАРТАПЫ</h2>
            </div>
        </header>

        <section class="filters-and-actions">
            <div class="filter-bar">
                <div class="filter-search">
                    {# Original SVG search icon structure from mockup - consider replacing with actual SVG via {% static %} #}
                    <div style="width: 22px; height: 22px; position: relative; opacity: 0.60; overflow: hidden">
                        <div style="width: 14.67px; height: 14.67px; left: 1.75px; top: 2.75px; position: absolute; border: 1.50px #A1A0A0 solid;"></div>
                        <div style="width: 3.99px; height: 3.99px; left: 14.27px; top: 15.26px; position: absolute; border: 1.50px #A1A0A0 solid;"></div>
                    </div>
                    <input type="text" placeholder="Поиск">
                </div>
                <a href="?filter=all" class="filter-button active">Все</a>
                <a href="?filter=category" class="filter-button inactive">
                    Категории
                    <img src="{% static 'accounts/images/icons/expand_more.svg' %}" alt="Категории" class="filter-icon">
                </a>
                <a href="?filter=new" class="filter-button inactive">
                    <img src="{% static 'accounts/images/icons/swap-vertical-outline.svg' %}" alt="Новые" class="filter-icon">
                    Новые
                </a>
            </div>

            {% if pending_startups %}
            <div class="startup-cards-grid">
                {% for startup in pending_startups %}
                <div class="startup-card-item">
                    <div class="startup-card-item-content">
                        <div class="startup-card-main-info">
                            {% if startup.planet_logo %}
                                <img src="{{ startup.planet_logo.url }}" alt="{{ startup.title }} logo" class="startup-card-image">
                            {% else %}
                                <div class="startup-card-image-placeholder">Нет лого</div>
                            {% endif %}
                            
                            <div class="startup-card-details">
                                <div class="detail-group">
                                    <span class="detail-label">Автор</span>
                                    <div class="author-info">
                                        {% if startup.owner %}
                                            {% if startup.owner.profile.avatar %}
                                                <img src="{{ startup.owner.profile.avatar.url }}" alt="{{ startup.owner.get_full_name|default:startup.owner.email|default:'Автор' }}" class="author-avatar">
                                            {% elif startup.owner.profile_picture_url %}
                                                <img src="{{ startup.owner.profile_picture_url }}" alt="{{ startup.owner.get_full_name|default:startup.owner.email|default:'Автор' }}" class="author-avatar">
                                            {% else %}
                                                 <div class="author-avatar-placeholder"></div> {# Placeholder for avatar #}
                                            {% endif %}
                                            <div class="author-text-details">
                                                <span class="author-name">{{ startup.owner.get_full_name|default:startup.owner.email|default:"Не указан" }}</span>
                                                <span class="author-rating">Рейтинг 4,2/5</span> {# Placeholder #}
                                                <a href="#" class="author-reviews-link">Отзывы</a> {# Placeholder #}
                                            </div>
                                        {% else %}
                                            <div class="author-avatar-placeholder"></div>
                                            <div class="author-text-details">
                                                <span class="author-name">Автор не указан</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="detail-group">
                                    <span class="detail-label">Наименование</span>
                                    <h3 class="startup-name">{{ startup.title }}</h3>
                                </div>

                                <div class="detail-group">
                                    <span class="detail-label">Категория</span>
                                    <div class="category-tag">
                                        <span class="category-tag-text">{{ startup.direction.direction_name|default:"Не указана" }}</span>
                                    </div>
                                </div>

                                <div class="detail-group">
                                    <span class="detail-label">Тип</span>
                                    <div class="type-tag">
                                        {# Assuming startup.type or similar field exists, using placeholder for now #}
                                        {# We need to determine how 'type_of_investment' is stored. Based on StartupForm, it could be 'invest', 'buy', 'both'. We need a mapping to display text. #}
                                        {% if startup.only_invest %}
                                            <span class="type-tag-text">Инвестирование</span>
                                        {% elif startup.only_buy %}
                                            <span class="type-tag-text">Выкуп</span>
                                        {% elif startup.both_mode %}
                                            <span class="type-tag-text">Выкуп+инвестирование</span>
                                        {% else %}
                                            <span class="type-tag-text">Не указан</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="startup-description-group">
                            <span class="detail-label">Описание</span>
                            <p class="startup-description-text">{{ startup.description|default:startup.short_description|default:"Описание отсутствует."|truncatewords:30 }}</p>
                        </div>

                        <div class="funding-info-actions">
                            <div class="funding-details-row">
                                <div class="funding-goal-block">
                                    <span class="funding-goal-label">Цель финансирования</span>
                                    <span class="funding-goal-amount">{{ startup.funding_goal|default:"0"|intcomma }} &#8381;</span>
                                </div>
                                <div class="action-buttons-group">
                                     <form method="post" action="{% url 'approve_startup' startup.startup_id %}" class="inline-form">
                                        {% csrf_token %}
                                        <button type="submit" class="action-button primary">Одобрить</button>
                                    </form>
                                    <form method="post" action="{% url 'reject_startup' startup.startup_id %}" class="inline-form">
                                        {% csrf_token %}
                                        <button type="submit" class="action-button danger">Отклонить</button>
                                    </form>
                                    <a href="{% url 'startup_detail' startup.startup_id %}" class="action-button secondary">К заявке</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="no-applications">Нет заявок на рассмотрение.</p>
            {% endif %}
        </section>

        {% if pending_startups %} {# Assuming "Показать еще" is for pagination, show if there are items #}
        <div class="show-more-bar">
            <a href="#" class="show-more-button">
                Показать еще
                {# Placeholder for eye icon from mockup - ideally replace with SVG #}
                 <div class="show-more-icon-placeholder"><div></div></div>
            </a>
        </div>
        {% endif %}
    </div>
</body>
{% endblock %}