{% extends 'accounts/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Панель модератора - Заявки{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'accounts/css/moderator_dashboard.css' %}">
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const filterButtons = document.querySelectorAll('.filter-button');
        filterButtons.forEach(button => {
            // TODO: Logic to set active based on URL query parameters if needed
            button.addEventListener('click', function(event) {
                // Basic example: remove active from all, add to clicked
                // For actual filtering, you'd likely navigate or use AJAX
                // filterButtons.forEach(btn => btn.classList.remove('active'));
                // this.classList.add('active');
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<body class="moderator-dashboard-body">
    <div class="moderator-page-container">
        <header class="page-header">
            <div class="header-title-block">
                <h1 class="header-title-main">Заявки на</h1>
                <h2 class="header-title-highlight">СТАРТАПЫ</h2>
                <p>Тест форматирования: {{ 1234567|intcomma }}</p>
            </div>
        </header>

        <section class="filters-and-actions">
            <div class="filter-bar">
                <div class="filter-search">
                    <img src="{% static 'accounts/images/search.svg' %}" alt="Поиск">
                    <input type="text" placeholder="Поиск">
                </div>
                <a href="?filter=all" class="filter-button active">Все</a> 
                <a href="?filter=category_filter" class="filter-button inactive">
                    Категории
                    <img src="{% static 'accounts/images/icons/expand_more.svg' %}" alt="Категории" class="filter-icon">
                </a>
                <a href="?filter=new" class="filter-button inactive">
                    <img src="{% static 'accounts/images/icons/swap-vertical-outline.svg' %}" alt="Новые" class="filter-icon">
                    Новые
                </a>
            </div>

            {% if pending_startups %}
            <div class="startup-cards-grid">
                {% for startup in pending_startups %}
                <div class="startup-card-item">
                    <div class="startup-card-item-content">
                        <div class="startup-card-main-info">
                            {% if startup.planet_logo %}
                                <img src="{{ startup.planet_logo.url }}" alt="{{ startup.title }} logo" class="startup-card-image">
                            {% else %}
                                <div class="startup-card-image-placeholder">Нет лого</div>
                            {% endif %}
                            
                            <div class="startup-card-details">
                                <div class="detail-group">
                                    <span class="detail-label">Автор</span>
                                    <div class="author-info">
                                        {% if startup.owner %}
                                            {% if startup.owner.profile.avatar %}
                                                <img src="{{ startup.owner.profile.avatar.url }}" alt="{{ startup.owner.get_full_name|default:startup.owner.email|default:'Автор' }}" class="author-avatar">
                                            {% elif startup.owner.profile_picture_url %}
                                                <img src="{{ startup.owner.profile_picture_url }}" alt="{{ startup.owner.get_full_name|default:startup.owner.email|default:'Автор' }}" class="author-avatar">
                                            {% else %}
                                                 <div class="author-avatar-placeholder"></div>
                                            {% endif %}
                                            <div class="author-text-details">
                                                <span class="author-name">{{ startup.owner.get_full_name|default:startup.owner.email|default:"Не указан" }}</span>
                                                <span class="author-rating">Рейтинг 4,2/5</span> {# Placeholder #}
                                                <a href="#" class="author-reviews-link">Отзывы</a> {# Placeholder #}
                                            </div>
                                        {% else %}
                                            <div class="author-avatar-placeholder"></div>
                                            <div class="author-text-details">
                                                <span class="author-name">Автор не указан</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="detail-group">
                                    <span class="detail-label">Наименование</span>
                                    <h3 class="startup-name">{{ startup.title }}</h3>
                                </div>

                                <div class="detail-group">
                                    <span class="detail-label">Категория</span>
                                    <div class="category-tag">
                                        <span class="category-tag-text">
                                            {% with original_name=startup.direction.direction_name|default:""|lower %}
                                                {% if original_name == "medicine" %}Медицина
                                                {% elif original_name == "auto" %}Автомобили
                                                {% elif original_name == "delivery" %}Доставка
                                                {% elif original_name == "cafe" or original_name == "кафе/рестораны" %}Кафе/рестораны
                                                {% elif original_name == "fastfood" %}Фастфуд
                                                {% elif original_name == "health" %}Здоровье
                                                {% elif original_name == "beauty" %}Красота
                                                {% elif original_name == "transport" %}Транспорт
                                                {% elif original_name == "sport" %}Спорт
                                                {% elif original_name == "psychology" %}Психология
                                                {% elif original_name == "ai" or original_name == "ии" %}ИИ
                                                {% elif original_name == "finance" %}Финансы
                                                {% elif original_name == "healthcare" %}Здравоохранение
                                                {% elif original_name == "technology" %}Технологии
                                                {# Добавьте другие категории и их переводы здесь, если они есть в вашей системе #}
                                                {% else %}{{ startup.direction.direction_name|default:"Не указана" }}{# Возвращаем оригинал или "Не указано" #}
                                                {% endif %}
                                            {% endwith %}
                                        </span>
                                    </div>
                                </div>

                                <div class="detail-group">
                                    <span class="detail-label">Тип</span>
                                    <div class="type-tag">
                                        {% if startup.only_invest %}
                                            <span class="type-tag-text">Инвестирование</span>
                                        {% elif startup.only_buy %}
                                            <span class="type-tag-text">Выкуп</span>
                                        {% elif startup.both_mode %}
                                            <span class="type-tag-text">Выкуп+инвестирование</span>
                                        {% else %}
                                            <span class="type-tag-text">Не указан</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="startup-description-group">
                            <span class="detail-label">Описание</span>
                            <p class="startup-description-text">{{ startup.description|default:startup.short_description|default:"Описание отсутствует."|truncatewords:30 }}</p>
                        </div>
                    </div> {# End of startup-card-item-content #}

                    <div class="funding-info-actions">
                        <div class="funding-details-row">
                            <div class="funding-goal-block">
                                <span class="funding-goal-label">Цель финансирования</span>
                                <span class="funding-goal-amount">{{ startup.funding_goal|default:"0"|floatformat:"0"|intcomma }} &#8381;</span>
                            </div>
                            <div class="action-buttons-group">
                                 <form method="post" action="{% url 'approve_startup' startup.startup_id %}" class="inline-form">
                                    {% csrf_token %}
                                    <button type="submit" class="action-button approve">Одобрить</button>
                                </form>
                                <form method="post" action="{% url 'reject_startup' startup.startup_id %}" class="inline-form">
                                    {% csrf_token %}
                                    <button type="submit" class="action-button reject">Отклонить</button>
                                </form>
                                <a href="{% url 'startup_detail' startup.startup_id %}" class="action-button details">К заявке</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="no-applications">Нет заявок на рассмотрение.</p>
            {% endif %}
        </section>

        {% if pending_startups %} 
        <div class="show-more-bar">
            <a href="#" class="show-more-button">
                Показать еще
                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16px" height="16px">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                </svg>
            </a>
        </div>
        {% endif %}
    </div>
</body>
{% endblock %}